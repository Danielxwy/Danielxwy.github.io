[{"title":"游戏开发遇到的奇怪问题（一）","date":"2025-04-19T18:00:59.000Z","url":"/posts/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E9%81%87%E5%88%B0%E7%9A%84%E5%A5%87%E6%80%AA%E9%97%AE%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/","tags":[["微信小游戏","/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E6%B8%B8%E6%88%8F/"],["iOS","/tags/iOS/"]],"categories":[["疑难杂症","/categories/%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87/"]],"content":" 💢 天杀的iOS！！！公司的测试机全都没法复现，只有策划的iOS才能复现的神人bug。 问题&amp;复现iOS在关闭WiFi的时候Socket不会立马断开（不管打没打开蜂窝网络），所以会导致在断开WiFi的时候，如果玩家的交互会与服务器进行数据传输，客户端的表现为没有反应也就是卡住了。 这个问题要解决的话还好，微信提供了一个监听网络状态的接口wx.onNetworkStatusChange，所以只要监听网络状态，如果网络连接断开了就手动调用下socket.close()，然后正常走重连流程，这样就完美解决这个问题了。 上述操作搞定后在公司的测试机上测了一遍没有问题，但是策划在自己的iOS上测试后发现这个解决方案居然失效了… 然后我就开始加日志，结果发现在手动调用socket.close()之后居然没有触发Socket的onClose事件，奇了怪了…不过我也没多想，手动调用下Socket的onClose回调就行了，这次测试了下没出现问题，就在我以为问题已经解决了后，策划又传来悲报： 策划：“又出问题了，重连几次后卡死了，游戏都进不去了”我：“……” 没办法，我又拿起他的手机开始测试，发现确实前几次能正常重连上，但是反复几次后就连不上了，而且回到登录页都没法登录了直接。测了好几次后终于也是发现了规律，重连到第五次后就连不上了，服务器也没收到任何协议或请求，加上登录的那一次就是一共5次Socket连接，我就开始在想，微信不会限制了Socket的并发连接数量吧，我一搜还真是。 1.7.0 及以上版本，最多可以同时存在 5 个 WebSocket 连接。 那也不对啊…我不是都有手动调用关闭Socket吗，这个时候突然想起来，哦…所以之前手动调用的socket.close()没有触发onClose事件，然后我就开始猜测前面几次的Socket是不是没有正确关闭，结果一打日志发现，success回调居然还是执行了的，还有这种事!？我当时就奇了怪了… 实在没办法了，我开始在网上搜索解决方案，“不可能就我一个遇到这种问题的吧”，一搜，确实能搜出来好些相关的，以为有救了，结果一点进去，全是： 内容不存在 tm的这个微信开放社区也是个sb！受不了了，后来又是问LLM又是找各个论坛，花了一整天的时间，居然没一个方案是有效的… 解决方案-没有解决方案- 最后是给Socket连接加了个超时定时器，一般来说Socket连接成功或者失败都会执行回调，但是这个bug在Socket第五次连接的时候回调永远不会执行，所以设定了一个5秒的定时器，如果Socket的回调没有被执行就弹窗（直接重启的话玩家还以为闪退了呢）让玩家重启小游戏。 后记 第二天和后端研究了一天，依然没有解决方案，一致认为是微信底层的问题，并且反馈给了微信。 第三天摇了个大佬来看了一个上午，同样认为是微信的问题，说我们代码没问题。 "},{"date":"2024-11-15T15:39:07.957Z","url":"/addons/leave-event.js","categories":[["undefined",""]],"content":"(() => { // 配置部分 const leaveDelay = 0.1; // 触发事件的延迟，单位为秒 const leaveFavicon = null; // 触发事件后的图标路径，设置为 null 表示不替换图标 const leaveTitle = \"{{{(>_"},{"date":"2024-11-17T06:11:13.003Z","url":"/addons/live2d-widget/waifu-tips.json","categories":[["undefined",""]],"content":"{\"mouseover\":[{\"selector\":\"#live2d\",\"text\":[\"干嘛呢你，快把手拿开～～\",\"鼠…鼠标放错地方了！\",\"你要干嘛呀？\",\"喵喵喵？\",\"怕怕(ノ≧∇≦)ノ\",\"非礼呀！救命！\",\"这样的话，只能使用武力了！\",\"我要生气了哦\",\"不要动手动脚的！\",\"真…真的是不知羞耻！\",\"Hentai！\"]},{\"selector\":\"#waifu-tool-hitokoto\",\"text\":[\"猜猜我要说些什么？\",\"我从青蛙王子那里听到了不少人生经验。\"]},{\"selector\":\"#waifu-tool-asteroids\",\"text\":[\"要不要来玩飞机大战？\",\"这个按钮上写着「不要点击」。\",\"怎么，你想来和我玩个游戏？\",\"听说这样可以蹦迪！\"]},{\"selector\":\"#waifu-tool-switch-model\",\"text\":[\"你是不是不爱人家了呀，呜呜呜～\",\"要见见我的姐姐嘛？\",\"想要看我妹妹嘛？\",\"要切换看板娘吗？\"]},{\"selector\":\"#waifu-tool-switch-texture\",\"text\":[\"喜欢换装 PLAY 吗？\",\"这次要扮演什么呢？\",\"变装！\",\"让我们看看接下来会发生什么！\"]},{\"selector\":\"#waifu-tool-photo\",\"text\":[\"你要给我拍照呀？一二三～茄子～\",\"要不，我们来合影吧！\",\"保持微笑就好了～\"]},{\"selector\":\"#waifu-tool-info\",\"text\":[\"想要知道更多关于我的事么？\",\"这里记录着我搬家的历史呢。\",\"你想深入了解我什么呢？\"]},{\"selector\":\"#waifu-tool-quit\",\"text\":[\"到了要说再见的时候了吗？\",\"呜呜 QAQ 后会有期……\",\"不要抛弃我呀……\",\"我们，还能再见面吗……\",\"哼，你会后悔的！\"]},{\"selector\":\".menu-item-home a\",\"text\":[\"点击前往首页，想回到上一页可以使用浏览器的后退功能哦。\",\"点它就可以回到首页啦！\",\"回首页看看吧。\"]},{\"selector\":\".menu-item-about a\",\"text\":[\"你想知道我家主人是谁吗？\",\"这里有一些关于我家主人的秘密哦，要不要看看呢？\",\"发现主人出没地点！\"]},{\"selector\":\".menu-item-tags a\",\"text\":[\"点击就可以看文章的标签啦！\",\"点击来查看所有标签哦。\"]},{\"selector\":\".menu-item-categories a\",\"text\":[\"文章都分类好啦～\",\"点击来查看文章分类哦。\"]},{\"selector\":\".menu-item-archives a\",\"text\":[\"翻页比较麻烦吗，那就来看看文章归档吧。\",\"文章目录都整理在这里啦！\"]},{\"selector\":\".menu-item-friends a\",\"text\":[\"这是我的朋友们哦ヾ(◍°∇°◍)ﾉﾞ\",\"要去大佬们的家看看吗？\",\"要去拜访一下我的朋友们吗？\"]},{\"selector\":\".menu-item-search a\",\"text\":[\"找不到想看的内容？搜索看看吧！\",\"在找什么东西呢，需要帮忙吗？\"]},{\"selector\":\".menu-item a\",\"text\":[\"快看看这里都有什么呢？\"]},{\"selector\":\".site-author\",\"text\":[\"我家主人好看吗？\",\"这是我家主人(*´∇｀*)\"]},{\"selector\":\".site-state\",\"text\":[\"这是文章的统计信息～\",\"要不要点进去看看？\"]},{\"selector\":\".feed-link a\",\"text\":[\"这里可以使用 RSS 订阅呢！\",\"利用 feed 订阅器，就能快速知道博客有没有更新了呢。\"]},{\"selector\":\".cc-opacity, .post-copyright-author\",\"text\":[\"要记得规范转载哦。\",\"所有文章均采用 CC BY-NC-SA 4.0 许可协议～\",\"转载前要先注意下文章的版权协议呢。\"]},{\"selector\":\".links-of-author\",\"text\":[\"这里是主人的常驻地址哦。\",\"这里有主人的联系方式！\"]},{\"selector\":\".followme\",\"text\":[\"手机扫一下就能继续看，很方便呢～\",\"扫一扫，打开新世界的大门！\"]},{\"selector\":\".fancybox img, img.medium-zoom-image\",\"text\":[\"点击图片可以放大呢！\"]},{\"selector\":\".copy-btn\",\"text\":[\"代码可以直接点击复制哟。\"]},{\"selector\":\".highlight .table-container, .gist\",\"text\":[\"GitHub！我是新手！\",\"PHP 是最好的语言！\"]},{\"selector\":\"a[href^='mailto']\",\"text\":[\"邮件我会及时回复的！\",\"点击就可以发送邮件啦～\"]},{\"selector\":\"a[href^='/tags/']\",\"text\":[\"要去看看 {text} 标签么？\",\"点它可以查看此标签下的所有文章哟！\"]},{\"selector\":\"a[href^='/categories/']\",\"text\":[\"要去看看 {text} 分类么？\",\"点它可以查看此分类下的所有文章哟！\"]},{\"selector\":\".post-title-link\",\"text\":[\"要看看 {text} 这篇文章吗？\"]},{\"selector\":\"a[rel='contents']\",\"text\":[\"点击来阅读全文哦。\"]},{\"selector\":\"a[itemprop='discussionUrl']\",\"text\":[\"要去看看评论吗？\"]},{\"selector\":\".beian a\",\"text\":[\"我也是有户口的人哦。\",\"我的主人可是遵纪守法的好主人。\"]},{\"selector\":\".container a[href^='http'], .nav-link .nav-text\",\"text\":[\"要去看看 {text} 么？\",\"去 {text} 逛逛吧。\",\"到 {text} 看看吧。\"]},{\"selector\":\".back-to-top\",\"text\":[\"点它就可以回到顶部啦！\",\"又回到最初的起点～\",\"要回到开始的地方么？\"]},{\"selector\":\".reward-container\",\"text\":[\"我是不是棒棒哒～快给我点赞吧！\",\"要打赏我嘛？好期待啊～\",\"主人最近在吃土呢，很辛苦的样子，给他一些钱钱吧～\"]},{\"selector\":\"#wechat\",\"text\":[\"这是我的微信二维码～\"]},{\"selector\":\"#alipay\",\"text\":[\"这是我的支付宝哦！\"]},{\"selector\":\"#bitcoin\",\"text\":[\"这是我的比特币账号！\"]},{\"selector\":\"#needsharebutton-postbottom .btn\",\"text\":[\"好东西要让更多人知道才行哦。\",\"觉得文章有帮助的话，可以分享给更多需要的朋友呢。\"]},{\"selector\":\".need-share-button_weibo\",\"text\":[\"微博？来分享一波喵！\"]},{\"selector\":\".need-share-button_wechat\",\"text\":[\"分享到微信吧！\"]},{\"selector\":\".need-share-button_douban\",\"text\":[\"分享到豆瓣好像也不错！\"]},{\"selector\":\".need-share-button_qqzone\",\"text\":[\"QQ 空间，一键转发，耶～\"]},{\"selector\":\".need-share-button_twitter\",\"text\":[\"Twitter？好像是不存在的东西？\"]},{\"selector\":\".need-share-button_facebook\",\"text\":[\"emmm…FB 好像也是不存在的东西？\"]},{\"selector\":\".post-nav-item a[rel='next']\",\"text\":[\"来看看下一篇文章吧。\",\"点它可以看下一篇文章哦！\",\"要翻到下一篇文章吗？\"]},{\"selector\":\".post-nav-item a[rel='prev']\",\"text\":[\"来看看上一篇文章吧。\",\"点它可以看上一篇文章哦！\",\"要翻到上一篇文章吗？\"]},{\"selector\":\".extend.next\",\"text\":[\"去下一页看看吧。\",\"点它可以前进哦！\",\"要翻到下一页吗？\"]},{\"selector\":\".extend.prev\",\"text\":[\"去上一页看看吧。\",\"点它可以后退哦！\",\"要翻到上一页吗？\"]},{\"selector\":\"input.vnick\",\"text\":[\"该怎么称呼你呢？\",\"留下你的尊姓大名！\"]},{\"selector\":\".vmail\",\"text\":[\"留下你的邮箱，不然就是无头像人士了！\",\"记得设置好 Gravatar 头像哦！\",\"为了方便通知你最新消息，一定要留下邮箱！\"]},{\"selector\":\".vlink\",\"text\":[\"快快告诉我你的家在哪里，好让我去参观参观！\"]},{\"selector\":\".veditor\",\"text\":[\"想要去评论些什么吗？\",\"要说点什么吗？\",\"觉得博客不错？快来留言和主人交流吧！\"]},{\"selector\":\".vcontrol a\",\"text\":[\"你会不会熟练使用 Markdown 呀？\",\"使用 Markdown 让评论更美观吧～\"]},{\"selector\":\".vemoji-btn\",\"text\":[\"要插入一个萌萌哒的表情吗？\",\"要来一发表情吗？\"]},{\"selector\":\".vpreview-btn\",\"text\":[\"要预览一下你的发言吗？\",\"快看看你的评论有多少负熵！\"]},{\"selector\":\".vsubmit\",\"text\":[\"评论没有审核，要对自己的发言负责哦～\",\"要提交了吗，请耐心等待回复哦～\"]},{\"selector\":\".vcontent\",\"text\":[\"哇，快看看这个精彩评论！\",\"如果有疑问，请尽快留言哦～\"]}],\"click\":[{\"selector\":\"#live2d\",\"text\":[\"是…是不小心碰到了吧…\",\"萝莉控是什么呀？\",\"你看到我的小熊了吗？\",\"再摸的话我可要报警了！⌇●﹏●⌇\",\"110 吗，这里有个变态一直在摸我(ó﹏ò｡)\",\"不要摸我了，我会告诉老婆来打你的！\",\"干嘛动我呀！小心我咬你！\",\"别摸我，有什么好摸的！\"]},{\"selector\":\".veditor\",\"text\":[\"要吐槽些什么呢？\",\"一定要认真填写喵～\",\"有什么想说的吗？\"]},{\"selector\":\".vsubmit\",\"text\":[\"输入验证码就可以提交评论啦～\"]}],\"seasons\":[{\"date\":\"01/01\",\"text\":\"元旦了呢，新的一年又开始了，今年是{year}年～\"},{\"date\":\"02/14\",\"text\":\"又是一年情人节，{year}年找到对象了嘛～\"},{\"date\":\"03/08\",\"text\":\"今天是国际妇女节！\"},{\"date\":\"03/12\",\"text\":\"今天是植树节，要保护环境呀！\"},{\"date\":\"04/01\",\"text\":\"悄悄告诉你一个秘密～今天是愚人节，不要被骗了哦～\"},{\"date\":\"05/01\",\"text\":\"今天是五一劳动节，计划好假期去哪里了吗～\"},{\"date\":\"06/01\",\"text\":\"儿童节了呢，快活的时光总是短暂，要是永远长不大该多好啊…\"},{\"date\":\"09/03\",\"text\":\"中国人民抗日战争胜利纪念日，铭记历史、缅怀先烈、珍爱和平、开创未来。\"},{\"date\":\"09/10\",\"text\":\"教师节，在学校要给老师问声好呀～\"},{\"date\":\"10/01\",\"text\":\"国庆节到了，为祖国母亲庆生！\"},{\"date\":\"11/05-11/12\",\"text\":\"今年的双十一是和谁一起过的呢～\"},{\"date\":\"12/20-12/31\",\"text\":\"这几天是圣诞节，主人肯定又去剁手买买买了～\"}],\"time\":[{\"hour\":\"6-7\",\"text\":\"早上好！一日之计在于晨，美好的一天就要开始了～\"},{\"hour\":\"8-11\",\"text\":\"上午好！工作顺利嘛，不要久坐，多起来走动走动哦！\"},{\"hour\":\"12-13\",\"text\":\"中午了，工作了一个上午，现在是午餐时间！\"},{\"hour\":\"14-17\",\"text\":\"午后很容易犯困呢，今天的运动目标完成了吗？\"},{\"hour\":\"18-19\",\"text\":\"傍晚了！窗外夕阳的景色很美丽呢，最美不过夕阳红～\"},{\"hour\":\"20-21\",\"text\":\"晚上好，今天过得怎么样？\"},{\"hour\":\"22-23\",\"text\":[\"已经这么晚了呀，早点休息吧，晚安～\",\"深夜时要爱护眼睛呀！\"]},{\"hour\":\"0-5\",\"text\":\"你是夜猫子呀？这么晚还不睡觉，明天起的来嘛？\"}],\"message\":{\"default\":[\"好久不见，日子过得好快呢……\",\"大坏蛋！你都多久没理人家了呀，嘤嘤嘤～\",\"嗨～快来逗我玩吧！\",\"拿小拳拳锤你胸口！\",\"记得把小家加入收藏夹哦！\"],\"console\":\"哈哈，你打开了控制台，是想要看看我的小秘密吗？\",\"copy\":\"你都复制了些什么呀，转载要记得加上出处哦！\",\"visibilitychange\":\"哇，你终于回来了～\"}}"},{"date":"2024-11-17T06:45:13.531Z","url":"/addons/live2d-widget/waifu-tips.js","categories":[["undefined",""]],"content":"/*! * Live2D Widget *  */ !function(){\"use strict\";function e(e){return Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e}let t;function o(o,s,n){if(!o||sessionStorage.getItem(\"waifu-text\")&&sessionStorage.getItem(\"waifu-text\")>n)return;t&&(clearTimeout(t),t=null),o=e(o),sessionStorage.setItem(\"waifu-text\",n);const i=document.getElementById(\"waifu-tips\");i.innerHTML=o,i.classList.add(\"waifu-tips-active\"),t=setTimeout((()=>{sessionStorage.removeItem(\"waifu-text\"),i.classList.remove(\"waifu-tips-active\")}),s)}class s{constructor(e){let{apiPath:t,cdnPath:o}=e,s=!1;if(\"string\"==typeof o)s=!0,o.endsWith(\"/\")||(o+=\"/\");else{if(\"string\"!=typeof t)throw\"Invalid initWidget argument!\";t.endsWith(\"/\")||(t+=\"/\")}this.useCDN=s,this.apiPath=t,this.cdnPath=o}async loadModelList(){const e=await fetch(`${this.cdnPath}model_list.json`);this.modelList=await e.json()}async loadModel(t,s,n){if(localStorage.setItem(\"modelId\",t),localStorage.setItem(\"modelTexturesId\",s),o(n,4e3,10),this.useCDN){this.modelList||await this.loadModelList();const o=e(this.modelList.models[t]);loadlive2d(\"live2d\",`${this.cdnPath}model/${o}/index.json`)}else loadlive2d(\"live2d\",`${this.apiPath}get/?id=${t}-${s}`),console.log(`Live2D 模型 ${t}-${s} 加载完成`)}async loadRandModel(){const t=localStorage.getItem(\"modelId\"),s=localStorage.getItem(\"modelTexturesId\");if(this.useCDN){this.modelList||await this.loadModelList();const s=e(this.modelList.models[t]);loadlive2d(\"live2d\",`${this.cdnPath}model/${s}/index.json`),o(\"我的新衣服好看嘛？\",4e3,10)}else fetch(`${this.apiPath}rand_textures/?id=${t}-${s}`).then((e=>e.json())).then((e=>{1!==e.textures.id||1!==s&&0!==s?this.loadModel(t,e.textures.id,\"我的新衣服好看嘛？\"):o(\"我还没有其他衣服呢！\",4e3,10)}))}async loadOtherModel(){let e=localStorage.getItem(\"modelId\");if(this.useCDN){this.modelList||await this.loadModelList();const t=++e>=this.modelList.models.length?0:e;this.loadModel(t,0,this.modelList.messages[t])}else fetch(`${this.apiPath}switch/?id=${e}`).then((e=>e.json())).then((e=>{this.loadModel(e.model.id,0,e.model.message)}))}}const n={hitokoto:{icon:'\\x3c!--! Font Awesome Free 6.6.0 by @fontawesome -  License -  (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --\\x3e',callback:function(){fetch(\"\").then((e=>e.json())).then((e=>{const t=`这句一言来自 「${e.from}」，是 ${e.creator} 在 hitokoto.cn 投稿的。`;o(e.hitokoto,6e3,9),setTimeout((()=>{o(t,4e3,9)}),6e3)}))}},asteroids:{icon:'\\x3c!--! Font Awesome Free 6.6.0 by @fontawesome -  License -  (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --\\x3e',callback:()=>{if(window.Asteroids)window.ASTEROIDSPLAYERS||(window.ASTEROIDSPLAYERS=[]),window.ASTEROIDSPLAYERS.push(new Asteroids);else{const e=document.createElement(\"script\");e.src=\"\",document.head.appendChild(e)}}},\"switch-model\":{icon:'\\x3c!--! Font Awesome Free 6.6.0 by @fontawesome -  License -  (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --\\x3e',callback:()=>{}},\"switch-texture\":{icon:'\\x3c!--! Font Awesome Free 6.6.0 by @fontawesome -  License -  (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --\\x3e',callback:()=>{}},photo:{icon:'\\x3c!--! Font Awesome Free 6.6.0 by @fontawesome -  License -  (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --\\x3e',callback:()=>{o(\"照好了嘛，是不是很可爱呢？\",6e3,9),Live2D.captureName=\"photo.png\",Live2D.captureFrame=!0}},info:{icon:'\\x3c!--! Font Awesome Free 6.6.0 by @fontawesome -  License -  (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --\\x3e',callback:()=>{open(\"\")}},quit:{icon:'\\x3c!--! Font Awesome Free 6.6.0 by @fontawesome -  License -  (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --\\x3e',callback:()=>{localStorage.setItem(\"waifu-display\",Date.now()),o(\"愿你有一天能与重要的人重逢。\",2e3,11),document.getElementById(\"waifu\").style.bottom=\"-500px\",setTimeout((()=>{document.getElementById(\"waifu\").style.display=\"none\",document.getElementById(\"waifu-toggle\").classList.add(\"waifu-toggle-active\")}),3e3)}}};function i(t){const i=new s(t);function c(t){let s,n,i=!1,c=t.message.default;window.addEventListener(\"mousemove\",(()=>i=!0)),window.addEventListener(\"keydown\",(()=>i=!0)),setInterval((()=>{i?(i=!1,clearInterval(s),s=null):s||(s=setInterval((()=>{o(c,6e3,9)}),2e4))}),1e3),o(function(e){if(\"/\"===location.pathname)for(let{hour:t,text:o}of e){const e=new Date,s=t.split(\"-\")[0],n=t.split(\"-\")[1]||s;if(s{for(let{selector:n,text:i}of t.click)if(s.target.closest(n))return i=e(i),i=i.replace(\"{text}\",s.target.innerText),void o(i,4e3,8)})),t.seasons.forEach((({date:t,text:o})=>{const s=new Date,n=t.split(\"-\")[0],i=t.split(\"-\")[1]||n;n.split(\"/\")[0]{document.hidden||o(t.message.visibilitychange,6e3,9)}))}localStorage.removeItem(\"waifu-display\"),sessionStorage.removeItem(\"waifu-text\"),document.body.insertAdjacentHTML(\"beforeend\",'\\n \\n \\n \\n '),setTimeout((()=>{document.getElementById(\"waifu\").style.bottom=0}),0),function(){n[\"switch-model\"].callback=()=>i.loadOtherModel(),n[\"switch-texture\"].callback=()=>i.loadRandModel(),Array.isArray(t.tools)||(t.tools=Object.keys(n));for(let e of t.tools)if(n[e]){const{icon:t,callback:o}=n[e];document.getElementById(\"waifu-tool\").insertAdjacentHTML(\"beforeend\",`${t}`),document.getElementById(`waifu-tool-${e}`).addEventListener(\"click\",o)}}(),function(){let e=localStorage.getItem(\"modelId\"),o=localStorage.getItem(\"modelTexturesId\");null===e&&(e=1,o=53),i.loadModel(e,o),fetch(t.waifuPath).then((e=>e.json())).then(c)}()}window.initWidget=function(e,t){\"string\"==typeof e&&(e={waifuPath:e,apiPath:t}),document.body.insertAdjacentHTML(\"beforeend\",'\\n 看板娘\\n ');const o=document.getElementById(\"waifu-toggle\");o.addEventListener(\"click\",(()=>{o.classList.remove(\"waifu-toggle-active\"),o.getAttribute(\"first-time\")?(i(e),o.removeAttribute(\"first-time\")):(localStorage.removeItem(\"waifu-display\"),document.getElementById(\"waifu\").style.display=\"\",setTimeout((()=>{document.getElementById(\"waifu\").style.bottom=0}),0))})),localStorage.getItem(\"waifu-display\")&&Date.now()-localStorage.getItem(\"waifu-display\"){o.classList.add(\"waifu-toggle-active\")}),0)):i(e)}}();"},{"date":"2025-02-21T12:06:05.744Z","url":"/addons/live2d-widget/waifu.css","categories":[["undefined",""]],"content":"#waifu-toggle { background-color: rgb(96, 170, 255); /* #fa0 */ border-radius: 5px; bottom: 68px; color: #fff; cursor: pointer; font-size: 12px; left: 0; margin-left: -100px; padding: 5px 2px 5px 5px; position: fixed; transition: margin-left 0.8s; width: 60px; writing-mode: vertical-rl; } #waifu-toggle.waifu-toggle-active { margin-left: -38px; /* -40px */ } #waifu-toggle.waifu-toggle-active:hover { margin-left: -32px; } #waifu { bottom: -1000px; left: 75px; /* 0 */ line-height: 0; margin-bottom: -10px; position: fixed; transform: translateY(6px); /* 3px */ transition: transform .2s ease-in-out, bottom 2s ease-in-out;/* .3s,3s */ z-index: 1; } #waifu:hover { transform: translateY(3px); /* 0 */ } #waifu-tips { animation: shake 50s ease-in-out 5s infinite; background-color: rgba(236, 217, 188, .5); border: 1px solid rgba(224, 186, 140, .62); border-radius: 12px; box-shadow: 0 3px 15px 2px rgba(191, 158, 118, .2); font-size: 14px; line-height: 24px; margin: -30px 20px; min-height: 70px; opacity: 0; overflow: hidden; padding: 5px 10px; position: absolute; text-overflow: ellipsis; transition: opacity 1s; width: 250px; word-break: break-all; } #waifu-tips.waifu-tips-active { opacity: 1; transition: opacity .2s; } #waifu-tips span { color: #0099cc; } #live2d { cursor: grab; height: 300px; position: relative; width: 300px; } #live2d:active { cursor: grabbing; } #waifu-tool { color: #aaa; opacity: 0; position: absolute; right: -10px; top: 70px; transition: opacity 1s; } #waifu:hover #waifu-tool { opacity: 1; } #waifu-tool span { display: block; height: 30px; text-align: center; } #waifu-tool svg { fill: #7b8c9d; cursor: pointer; height: 25px; transition: fill .3s; } #waifu-tool svg:hover { fill: rgb(96, 170, 255); /* #34495e */ /* #0684bd */ } @keyframes shake { 2% { transform: translate(.5px, -1.5px) rotate(-.5deg); } 4% { transform: translate(.5px, 1.5px) rotate(1.5deg); } 6% { transform: translate(1.5px, 1.5px) rotate(1.5deg); } 8% { transform: translate(2.5px, 1.5px) rotate(.5deg); } 10% { transform: translate(.5px, 2.5px) rotate(.5deg); } 12% { transform: translate(1.5px, 1.5px) rotate(.5deg); } 14% { transform: translate(.5px, .5px) rotate(.5deg); } 16% { transform: translate(-1.5px, -.5px) rotate(1.5deg); } 18% { transform: translate(.5px, .5px) rotate(1.5deg); } 20% { transform: translate(2.5px, 2.5px) rotate(1.5deg); } 22% { transform: translate(.5px, -1.5px) rotate(1.5deg); } 24% { transform: translate(-1.5px, 1.5px) rotate(-.5deg); } 26% { transform: translate(1.5px, .5px) rotate(1.5deg); } 28% { transform: translate(-.5px, -.5px) rotate(-.5deg); } 30% { transform: translate(1.5px, -.5px) rotate(-.5deg); } 32% { transform: translate(2.5px, -1.5px) rotate(1.5deg); } 34% { transform: translate(2.5px, 2.5px) rotate(-.5deg); } 36% { transform: translate(.5px, -1.5px) rotate(.5deg); } 38% { transform: translate(2.5px, -.5px) rotate(-.5deg); } 40% { transform: translate(-.5px, 2.5px) rotate(.5deg); } 42% { transform: translate(-1.5px, 2.5px) rotate(.5deg); } 44% { transform: translate(-1.5px, 1.5px) rotate(.5deg); } 46% { transform: translate(1.5px, -.5px) rotate(-.5deg); } 48% { transform: translate(2.5px, -.5px) rotate(.5deg); } 50% { transform: translate(-1.5px, 1.5px) rotate(.5deg); } 52% { transform: translate(-.5px, 1.5px) rotate(.5deg); } 54% { transform: translate(-1.5px, 1.5px) rotate(.5deg); } 56% { transform: translate(.5px, 2.5px) rotate(1.5deg); } 58% { transform: translate(2.5px, 2.5px) rotate(.5deg); } 60% { transform: translate(2.5px, -1.5px) rotate(1.5deg); } 62% { transform: translate(-1.5px, .5px) rotate(1.5deg); } 64% { transform: translate(-1.5px, 1.5px) rotate(1.5deg); } 66% { transform: translate(.5px, 2.5px) rotate(1.5deg); } 68% { transform: translate(2.5px, -1.5px) rotate(1.5deg); } 70% { transform: translate(2.5px, 2.5px) rotate(.5deg); } 72% { transform: translate(-.5px, -1.5px) rotate(1.5deg); } 74% { transform: translate(-1.5px, 2.5px) rotate(1.5deg); } 76% { transform: translate(-1.5px, 2.5px) rotate(1.5deg); } 78% { transform: translate(-1.5px, 2.5px) rotate(.5deg); } 80% { transform: translate(-1.5px, .5px) rotate(-.5deg); } 82% { transform: translate(-1.5px, .5px) rotate(-.5deg); } 84% { transform: translate(-.5px, .5px) rotate(1.5deg); } 86% { transform: translate(2.5px, 1.5px) rotate(.5deg); } 88% { transform: translate(-1.5px, .5px) rotate(1.5deg); } 90% { transform: translate(-1.5px, -.5px) rotate(-.5deg); } 92% { transform: translate(-1.5px, -1.5px) rotate(1.5deg); } 94% { transform: translate(.5px, .5px) rotate(-.5deg); } 96% { transform: translate(2.5px, -.5px) rotate(-.5deg); } 98% { transform: translate(-1.5px, -1.5px) rotate(-.5deg); } 0%, 100% { transform: translate(0, 0) rotate(0); } }"},{"date":"2024-11-17T06:11:12.995Z","url":"/addons/live2d-widget/live2d.min.js","categories":[["undefined",""]],"content":"!function(t){function i(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}var e={};i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p=\"\",i(i.s=4)}([function(t,i,e){\"use strict\";function r(){this.live2DModel=null,this.modelMatrix=null,this.eyeBlink=null,this.physics=null,this.pose=null,this.debugMode=!1,this.initialized=!1,this.updating=!1,this.alpha=1,this.accAlpha=0,this.lipSync=!1,this.lipSyncValue=0,this.accelX=0,this.accelY=0,this.accelZ=0,this.dragX=0,this.dragY=0,this.startTimeMSec=null,this.mainMotionManager=new h,this.expressionManager=new h,this.motions={},this.expressions={},this.isTexLoaded=!1}function o(){AMotion.prototype.constructor.call(this),this.paramList=new Array}function n(){this.id=\"\",this.type=-1,this.value=null}function s(){this.nextBlinkTime=null,this.stateStartTime=null,this.blinkIntervalMsec=null,this.eyeState=g.STATE_FIRST,this.blinkIntervalMsec=4e3,this.closingMotionMsec=100,this.closedMotionMsec=50,this.openingMotionMsec=150,this.closeIfZero=!0,this.eyeID_L=\"PARAM_EYE_L_OPEN\",this.eyeID_R=\"PARAM_EYE_R_OPEN\"}function _(){this.tr=new Float32Array(16),this.identity()}function a(t,i){_.prototype.constructor.call(this),this.width=t,this.height=i}function h(){MotionQueueManager.prototype.constructor.call(this),this.currentPriority=null,this.reservePriority=null,this.super=MotionQueueManager.prototype}function l(){this.physicsList=new Array,this.startTimeMSec=UtSystem.getUserTimeMSec()}function $(){this.lastTime=0,this.lastModel=null,this.partsGroups=new Array}function u(t){this.paramIndex=-1,this.partsIndex=-1,this.link=null,this.id=t}function p(){this.EPSILON=.01,this.faceTargetX=0,this.faceTargetY=0,this.faceX=0,this.faceY=0,this.faceVX=0,this.faceVY=0,this.lastTimeSec=0}function f(){_.prototype.constructor.call(this),this.screenLeft=null,this.screenRight=null,this.screenTop=null,this.screenBottom=null,this.maxLeft=null,this.maxRight=null,this.maxTop=null,this.maxBottom=null,this.max=Number.MAX_VALUE,this.min=0}function c(){}var d=0;r.prototype.getModelMatrix=function(){return this.modelMatrix},r.prototype.setAlpha=function(t){t>.999&&(t=1),t"},{"date":"2024-11-17T14:30:51.757Z","url":"/addons/comments/gitalk.css","categories":[["undefined",""]],"content":".gt-counts, .gt-header-textarea, .gt-user-name { color: var(--kr-theme-text) !important; } .gt-header-textarea, .gt-header-preview, .gt-btn-preview, .gt-comment-content, .gt-popup { background-color: var(--kr-theme-page-bg) !important; } .gt-popup { border-color: #6190e8 !important; }"},{"date":"2024-11-17T15:09:22.735Z","url":"/addons/comments/gitalk.js","categories":[["undefined",""]],"content":"(() => { const loadComments = async () => { if (typeof Gitalk === \"undefined\") { setTimeout(loadComments, 100); } else { const container = document.getElementById('gitalk-container'); if (!container) { return; } const path = container.getAttribute(\"data-path\"); const gitalk = new Gitalk(Object.assign({ id: path, // 直接使用路径作为 id // id: container.getAttribute(\"data-path-hash\"), // 使用 hash 作为 ID path: path, }, { clientID: 'Ov23liqoyiZGlCl2kk73', clientSecret: '2216cf9fc42e2dcbcfa86fc5eec922810ed7eaaf', repo: \"blog-comments\", owner: \"Danielxwy\", admin: [\"Danielxwy\"], distractionFreeMode: false, })); gitalk.render('gitalk-container'); } }; window.loadComments = loadComments; window.addEventListener('pjax:success', () => { window.loadComments = loadComments; }); })();"},{"date":"2024-11-17T14:39:32.085Z","url":"/addons/snow/snow.css","categories":[["undefined",""]],"content":"#snow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 99999; pointer-events: none; background: rgba(225, 225, 225, .05); }"},{"date":"2024-11-22T17:02:56.767Z","url":"/addons/snow/snow.js","categories":[["undefined",""]],"content":"(()=>{ // 设置雪花参数 const snowConf = { flakeCount: 100, minDist: 100, color: \"255, 255, 255\", size: 1.6, speed: 0.2, opacity: 0.3, stepsize: .1, fadeInSpeed: 0.02,// 越大越快 fadeOutSpeed: 0.02, flakeYieldForce: 0.1 }; const snowEnableStorageKey = \"snow-enable\"; const getLS = (k) => { try { return localStorage.getItem(k); } catch (e) { // 与 localStorage 中没有找到对应 key 的行为一致 return null; } }; // 记录下雪状态 let isSnowing = (getLS(snowEnableStorageKey) || \"true\") === \"true\"; document.addEventListener(\"OnSnowStateChange\", (event) => { const lastState = isSnowing; //重新开始 if (!lastState && event.detail.enable === \"true\") { isSnowing = true; startSnow(); fadeInCanvas(); } else if (lastState && event.detail.enable === \"false\") { fadeOutCanvas(); } }); const requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || function(callback){window.setTimeout(callback, 1000/60);}; window.requestAnimationFrame = requestAnimationFrame; const canvas = document.getElementById(\"snow\"); const ctx = canvas.getContext(\"2d\"); const flakeCount = snowConf.flakeCount; let mX = -100, mY = -100; let flakes = []; canvas.width = window.innerWidth; canvas.height = window.innerHeight; let fadeOutOpacity = 1.0; const fadeOutCanvas = () => { if (fadeOutOpacity > 0) { ctx.globalAlpha = fadeOutOpacity; fadeOutOpacity -= snowConf.fadeOutSpeed; // 调整步长以控制缓动速度 requestAnimationFrame(fadeOutCanvas); } else { isSnowing = false; // 清空画布 ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.globalAlpha = 1.0; fadeOutOpacity = 1.0; // 重置 } }; let fadeInOpacity = 0; const fadeInCanvas = () => { if (fadeInOpacity < 1) { ctx.globalAlpha = fadeInOpacity; fadeInOpacity += snowConf.fadeInSpeed; // 调整步长以控制缓动速度 requestAnimationFrame(fadeInCanvas); } else { ctx.globalAlpha = 1.0; fadeInOpacity = 0; // 重置 } }; const snow = () => { if (!isSnowing) { return; // 结束 } // 清空画布 ctx.clearRect(0, 0, canvas.width, canvas.height); const minDist = snowConf.minDist; for (let i = 0; i < flakeCount; i++){ let flake = flakes[i]; const x = mX, y = mY; const x2 = flake.x, y2 = flake.y; const dist = Math.sqrt((x - x2)*(x - x2) + (y - y2)*(y - y2)); if (dist < minDist) { const force = minDist / (dist*dist); const xcomp = (x - x2) / dist; const ycomp = (y - y2) / dist; const deltaV = force / 2 * snowConf.flakeYieldForce; flake.velX -= deltaV * xcomp; flake.velY -= deltaV * ycomp; } else { flake.velX *= 0.98; if (flake.velY < flake.speed && (flake.speed - flake.velY > .01)) { flake.velY += (flake.speed - flake.velY) * .01; } flake.velX += Math.cos(flake.step += .05) * flake.stepSize; } ctx.fillStyle = \"rgba(\" + snowConf.color + \", \" + flake.opacity + \")\"; flake.y += flake.velY; flake.x += flake.velX; if(flake.y >= canvas.height || flake.y = canvas.width || flake.x { flake.x = Math.floor(Math.random()*canvas.width); flake.y = 0; flake.size = (Math.random()*3)+2; flake.speed = (Math.random()*1)+0.5; flake.velY = flake.speed; flake.velX = 0; flake.opacity = (Math.random()*0.5)+0.3; }; const startSnow = () => { // 生成初始雪花 for (let i = 0; i < flakeCount; i++) { const x = Math.floor(Math.random()*canvas.width); const y = Math.floor(Math.random()*canvas.height); const size = (Math.random()*3) + snowConf.size; const speed = (Math.random()*1) + snowConf.speed; const opacity = (Math.random()*0.5) + snowConf.opacity; flakes.push({ speed: speed, velX: 0, velY: speed, x: x, y: y, size: size, stepSize: (Math.random()) / 30 * snowConf.stepsize, step: 0, angle: 180, opacity: opacity }); } // 开始下雪 snow(); }; // 雪花避让鼠标 document.addEventListener(\"mousemove\", (e)=>{mX = e.clientX, mY = e.clientY}); // 窗口大小调整 window.addEventListener(\"resize\",()=>{canvas.width = window.innerWidth; canvas.height = window.innerHeight;}); // 初始化 startSnow(); })();"},{"date":"2025-02-21T12:06:05.743Z","url":"/addons/live2d-widget/autoload.js","categories":[["undefined",""]],"content":"// live2d_path 参数建议使用绝对路径 // const live2d_path = \"\"; const live2d_path = \"/addons/live2d-widget/\"; // 封装异步加载资源的方法 function loadExternalResource(url, type) { return new Promise((resolve, reject) => { let tag; if (type === \"css\") { tag = document.createElement(\"link\"); tag.rel = \"stylesheet\"; tag.href = url; } else if (type === \"js\") { tag = document.createElement(\"script\"); tag.src = url; } if (tag) { tag.onload = () => resolve(url); tag.onerror = () => reject(url); document.head.appendChild(tag); } }); } // 加载 waifu.css live2d.min.js waifu-tips.js if (screen.width >= 768) { Promise.all([ // loadExternalResource(live2d_path + \"waifu.css\", \"css\"), loadExternalResource(live2d_path + \"live2d.min.js\", \"js\"), loadExternalResource(live2d_path + \"waifu-tips.js\", \"js\") ]).then(() => { // 配置选项的具体用法见 README.md initWidget({ waifuPath: live2d_path + \"waifu-tips.json\", //apiPath: \"\", cdnPath: \"\", tools: [\"hitokoto\", \"switch-model\", \"photo\", \"quit\"] // tools: [\"hitokoto\", \"asteroids\", \"switch-model\", \"switch-texture\", \"photo\", \"info\", \"quit\"] }); }); } console.log(` く__,.ヘヽ. / ,ー､ 〉 ＼ ', !-─‐-i / /´ ／｀ｰ' L/／｀ヽ､ / ／, /| , , ', ｲ / /-‐/ ｉ L_ ﾊ ヽ! i ﾚ ﾍ 7ｲ｀ﾄ ﾚ'ｧ-ﾄ､!ハ| | !,/7 '0' ´0iソ| | |.从\" _ ,,,, / |./ | ﾚ'| i＞.､,,__ _,.イ / .i | ﾚ'| | / k_７_/ﾚ'ヽ, ﾊ. | | |/i 〈|/ i ,.ﾍ | i | .|/ / ｉ： ﾍ! ＼ | kヽ>､ﾊ _,.ﾍ､ /､! !'〈//｀Ｔ´', ＼ ｀'7'ｰr' ﾚ'ヽL__|___i,___,ンﾚ|ノ ﾄ-,/ |___./ 'ｰ' !_,.: `);"},{"date":"2024-11-22T16:29:03.944Z","url":"/addons/mobile-hero.css","categories":[["undefined",""]],"content":"@media (max-width: 768px) { .kratos-start { height: unset !important; } .kratos-cover.kratos-cover-2.text-center { display: block; } }"},{"date":"2025-02-21T12:06:05.742Z","url":"/addons/aplayer/aplayer.css","categories":[["undefined",""]],"content":"#footer { padding-bottom: 32px; } .aplayer-list-title { color: #000; }"},{"date":"2025-02-18T13:08:37.083Z","url":"/addons/aplayer/aplayer.js","categories":[["undefined",""]],"content":"const ap = new APlayer({ container: document.getElementById('aplayer'), fixed: true, volume: 0.15, audio: [ { name: '旅人の唄', artist: '大原ゆい子', url: '../../bgm/旅人の唄 - 大原ゆい子.mp3', cover: '../../bgm/cover.webp' }, { name: '目覚めの唄', artist: '大原ゆい子', url: '../../bgm/目覚めの唄 - 大原ゆい子.mp3', cover: '../../bgm/cover.webp' } ], // 这里加载您的音频配置 });"},{"date":"2024-11-23T16:08:51.602Z","url":"/addons/cursor/cursor-effects.js","categories":[["undefined",""]],"content":"class Circle { constructor({ origin, speed, color, angle, context }) { this.origin = origin this.position = { ...this.origin } this.color = color this.speed = speed this.angle = angle this.context = context this.renderCount = 0 } draw() { this.context.fillStyle = this.color this.context.beginPath() this.context.arc(this.position.x, this.position.y, 2, 0, Math.PI * 2) this.context.fill() } move() { this.position.x = (Math.sin(this.angle) * this.speed) + this.position.x this.position.y = (Math.cos(this.angle) * this.speed) + this.position.y + (this.renderCount * 0.3) this.renderCount++ } } class Boom { constructor ({ origin, context, circleCount = 10, area }) { this.origin = origin this.context = context this.circleCount = circleCount this.area = area this.stop = false this.circles = [] } randomArray(range) { const length = range.length const randomIndex = Math.floor(length * Math.random()) return range[randomIndex] } randomColor() { const range = ['8', '9', 'A', 'B', 'C', 'D', 'E', 'F'] return '#' + this.randomArray(range) + this.randomArray(range) + this.randomArray(range) + this.randomArray(range) + this.randomArray(range) + this.randomArray(range) } randomRange(start, end) { return (end - start) * Math.random() + start } init() { for(let i = 0; i < this.circleCount; i++) { const circle = new Circle({ context: this.context, origin: this.origin, color: this.randomColor(), angle: this.randomRange(Math.PI - 1, Math.PI + 1), speed: this.randomRange(1, 6) }) this.circles.push(circle) } } move() { this.circles.forEach((circle, index) => { if (circle.position.x > this.area.width || circle.position.y > this.area.height) { return this.circles.splice(index, 1) } circle.move() }) if (this.circles.length == 0) { this.stop = true } } draw() { this.circles.forEach(circle => circle.draw()) } } class CursorSpecialEffects { constructor() { this.computerCanvas = document.createElement('canvas') this.renderCanvas = document.createElement('canvas') this.computerContext = this.computerCanvas.getContext('2d') this.renderContext = this.renderCanvas.getContext('2d') this.globalWidth = window.innerWidth this.globalHeight = window.innerHeight this.booms = [] this.running = false } handleMouseDown(e) { const boom = new Boom({ origin: { x: e.clientX, y: e.clientY }, context: this.computerContext, area: { width: this.globalWidth, height: this.globalHeight } }) boom.init() this.booms.push(boom) this.running || this.run() } handlePageHide() { this.booms = [] this.running = false } init() { const style = this.renderCanvas.style style.position = 'fixed' style.top = style.left = 0 style.zIndex = '999999999999999999999999999999999999999999' style.pointerEvents = 'none' style.width = this.renderCanvas.width = this.computerCanvas.width = this.globalWidth style.height = this.renderCanvas.height = this.computerCanvas.height = this.globalHeight document.body.append(this.renderCanvas) window.addEventListener('mousedown', this.handleMouseDown.bind(this)) window.addEventListener('pagehide', this.handlePageHide.bind(this)) } run() { this.running = true if (this.booms.length == 0) { return this.running = false } requestAnimationFrame(this.run.bind(this)) this.computerContext.clearRect(0, 0, this.globalWidth, this.globalHeight) this.renderContext.clearRect(0, 0, this.globalWidth, this.globalHeight) this.booms.forEach((boom, index) => { if (boom.stop) { return this.booms.splice(index, 1) } boom.move() boom.draw() }) this.renderContext.drawImage(this.computerCanvas, 0, 0, this.globalWidth, this.globalHeight) } } const cursorSpecialEffects = new CursorSpecialEffects() cursorSpecialEffects.init()"},{"date":"2025-02-18T13:08:49.703Z","url":"/addons/cursor/cursor-fireworks.js","categories":[["undefined",""]],"content":"var j = { scope: {} }; j.defineProperty = \"function\" == typeof Object.defineProperties ? Object.defineProperty : function(e, r, p) { if (p.get || p.set) { throw new TypeError(\"ES3 does not support getters and setters.\") } e != Array.prototype && e != Object.prototype && (e[r] = p.value) }; j.getGlobal = function(e) { return \"undefined\" != typeof window && window === e ? e : \"undefined\" != typeof global && null != global ? global : e }; j.global = j.getGlobal(this); j.SYMBOL_PREFIX = \"jscomp_symbol_\"; j.initSymbol = function() { j.initSymbol = function() {}; j.global.Symbol || (j.global.Symbol = j.Symbol) }; j.symbolCounter_ = 0; j.Symbol = function(e) { return j.SYMBOL_PREFIX + (e || \"\") + j.symbolCounter_++ }; j.initSymbolIterator = function() { j.initSymbol(); var e = j.global.Symbol.iterator; e || (e = j.global.Symbol.iterator = j.global.Symbol(\"iterator\")); \"function\" != typeof Array.prototype[e] && j.defineProperty(Array.prototype, e, { configurable: !0, writable: !0, value: function() { return j.arrayIterator(this) } }); j.initSymbolIterator = function() {} }; j.arrayIterator = function(e) { var r = 0; return j.iteratorPrototype(function() { return r < e.length ? { done: !1, value: e[r++] } : { done: !0 } }) }; j.iteratorPrototype = function(e) { j.initSymbolIterator(); e = { next: e }; e[j.global.Symbol.iterator] = function() { return this }; return e }; j.array = j.array || {}; j.iteratorFromArray = function(e, r) { j.initSymbolIterator(); e instanceof String && (e += \"\"); var p = 0, m = { next: function() { if (p < e.length) { var u = p++; return { value: r(u, e[u]), done: !1 } } m.next = function() { return { done: !0, value: void 0 } }; return m.next() } }; m[Symbol.iterator] = function() { return m }; return m }; j.polyfill = function(e, r, p, m) { if (r) { p = j.global; e = e.split(\".\"); for (m = 0; m < e.length - 1; m++) { var u = e[m]; u in p || (p[u] = {}); p = p[u] } e = e[e.length - 1]; m = p[e]; r = r(m); r != m && null != r && j.defineProperty(p, e, { configurable: !0, writable: !0, value: r }) } }; j.polyfill(\"Array.prototype.keys\", function(e) { return e ? e : function() { return j.iteratorFromArray(this, function(e) { return e }) } }, \"es6-impl\", \"es3\"); var j = this; (function(e, r) { \"function\" === typeof define && define.amd ? define([], r) : \"object\" === typeof module && module.exports ? module.exports = r() : e.anime = r() })(this, function() { function e(a) { if (!h.col(a)) { try { return document.querySelectorAll(a) } catch (c) {} } } function r(a, c) { for (var d = a.length, b = 2 "},{"date":"2025-04-11T16:19:21.960Z","url":"/addons/cursor/cursor.css","categories":[["undefined",""]],"content":".custom-cursor { cursor: url('../../assets/cursor/pointer-F1-256x256x32.png'), auto; } .custom-pointer { cursor: url('../../assets/cursor/link-F8-256x256x32.png'), pointer; }"},{"date":"2024-11-24T05:55:02.318Z","url":"/addons/cursor/cursor-fireworks-compressed.js","categories":[["undefined",""]],"content":"eval(function(p,a,c,k,e,r){e=function(c){return(c35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\\\b'+e(c)+'\\\\b','g'),k[c]);return p}('14 j={4W:{}};j.2a=\"12\"==1s 1K.4X?1K.2a:12(e,r,p){17(p.4Y||p.4Z){51 2K 52(\"54 56 57 58 59 5a 5b.\")}e!=1S.1L&&e!=1K.1L&&(e[r]=p.1l)};j.3w=12(e){13\"2L\"!=1s 1t&&1t===e?e:\"2L\"!=1s 1m&&2b!=1m?1m:e};j.1m=j.3w(1y);j.3x=\"5c\";j.2M=12(){j.2M=12(){};j.1m.1u||(j.1m.1u=j.1u)};j.3y=0;j.1u=12(e){13 j.3x+(e||\"\")+j.3y++};j.2c=12(){j.2M();14 e=j.1m.1u.1T;e||(e=j.1m.1u.1T=j.1m.1u(\"1T\"));\"12\"!=1s 1S.1L[e]&&j.2a(1S.1L,e,{3z:!0,3A:!0,1l:12(){13 j.3B(1y)}});j.2c=12(){}};j.3B=12(e){14 r=0;13 j.3C(12(){13 r"},{"title":"about-me","date":"2024-11-24T14:12:15.000Z","url":"/about-me/index.html","categories":[["undefined",""]],"content":"施工中…"},{"date":"2025-02-20T12:04:42.013Z","url":"/addons/thumbhash/thumbhash.js","categories":[["undefined",""]],"content":"/** * Encodes an RGBA image to a ThumbHash. RGB should not be premultiplied by A. * * @param w The width of the input image. Must be ≤100px. * @param h The height of the input image. Must be ≤100px. * @param rgba The pixels in the input image, row-by-row. Must have w*h*4 elements. * @returns The ThumbHash as a Uint8Array. */ function rgbaToThumbHash(w, h, rgba) { // Encoding an image larger than 100x100 is slow with no benefit if (w > 100 || h > 100) throw new Error(`${w}x${h} doesn't fit in 100x100`) let { PI, round, max, cos, abs } = Math // Determine the average color let avg_r = 0, avg_g = 0, avg_b = 0, avg_a = 0 for (let i = 0, j = 0; i < w * h; i++, j += 4) { let alpha = rgba[j + 3] / 255 avg_r += alpha / 255 * rgba[j] avg_g += alpha / 255 * rgba[j + 1] avg_b += alpha / 255 * rgba[j + 2] avg_a += alpha } if (avg_a) { avg_r /= avg_a avg_g /= avg_a avg_b /= avg_a } let hasAlpha = avg_a < w * h let l_limit = hasAlpha ? 5 : 7 // Use fewer luminance bits if there's alpha let lx = max(1, round(l_limit * w / max(w, h))) let ly = max(1, round(l_limit * h / max(w, h))) let l = [] // luminance let p = [] // yellow - blue let q = [] // red - green let a = [] // alpha // Convert the image from RGBA to LPQA (composite atop the average color) for (let i = 0, j = 0; i < w * h; i++, j += 4) { let alpha = rgba[j + 3] / 255 let r = avg_r * (1 - alpha) + alpha / 255 * rgba[j] let g = avg_g * (1 - alpha) + alpha / 255 * rgba[j + 1] let b = avg_b * (1 - alpha) + alpha / 255 * rgba[j + 2] l[i] = (r + g + b) / 3 p[i] = (r + g) / 2 - b q[i] = r - g a[i] = alpha } // Encode using the DCT into DC (constant) and normalized AC (varying) terms let encodeChannel = (channel, nx, ny) => { let dc = 0, ac = [], scale = 0, fx = [] for (let cy = 0; cy < ny; cy++) { for (let cx = 0; cx * ny < nx * (ny - cy); cx++) { let f = 0 for (let x = 0; x < w; x++) fx[x] = cos(PI / w * cx * (x + 0.5)) for (let y = 0; y < h; y++) for (let x = 0, fy = cos(PI / h * cy * (y + 0.5)); x < w; x++) f += channel[x + y * w] * fx[x] * fy f /= w * h if (cx || cy) { ac.push(f) scale = max(scale, abs(f)) } else { dc = f } } } if (scale) for (let i = 0; i < ac.length; i++) ac[i] = 0.5 + 0.5 / scale * ac[i] return [dc, ac, scale] } let [l_dc, l_ac, l_scale] = encodeChannel(l, max(3, lx), max(3, ly)) let [p_dc, p_ac, p_scale] = encodeChannel(p, 3, 3) let [q_dc, q_ac, q_scale] = encodeChannel(q, 3, 3) let [a_dc, a_ac, a_scale] = hasAlpha ? encodeChannel(a, 5, 5) : [] // Write the constants let isLandscape = w > h let header24 = round(63 * l_dc) | (round(31.5 + 31.5 * p_dc) < 6) | (round(31.5 + 31.5 * q_dc) < 12) | (round(31 * l_scale) < 18) | (hasAlpha < 23) let header16 = (isLandscape ? ly : lx) | (round(63 * p_scale) < 3) | (round(63 * q_scale) < 9) | (isLandscape < 15) let hash = [header24 & 255, (header24 >> 8) & 255, header24 >> 16, header16 & 255, header16 >> 8] let ac_start = hasAlpha ? 6 : 5 let ac_index = 0 if (hasAlpha) hash.push(round(15 * a_dc) | (round(15 * a_scale) < 4)) // Write the varying factors for (let ac of hasAlpha ? [l_ac, p_ac, q_ac, a_ac] : [l_ac, p_ac, q_ac]) for (let f of ac) hash[ac_start + (ac_index >> 1)] |= round(15 * f) < ((ac_index++ & 1) < 2) return new Uint8Array(hash) } /** * Decodes a ThumbHash to an RGBA image. RGB is not be premultiplied by A. * * @param hash The bytes of the ThumbHash. * @returns The width, height, and pixels of the rendered placeholder image. */ function thumbHashToRGBA(hash) { let { PI, min, max, cos, round } = Math // Read the constants let header24 = hash[0] | (hash[1] < 8) | (hash[2] < 16) let header16 = hash[3] | (hash[4] < 8) let l_dc = (header24 & 63) / 63 let p_dc = ((header24 >> 6) & 63) / 31.5 - 1 let q_dc = ((header24 >> 12) & 63) / 31.5 - 1 let l_scale = ((header24 >> 18) & 31) / 31 let hasAlpha = header24 >> 23 let p_scale = ((header16 >> 3) & 63) / 63 let q_scale = ((header16 >> 9) & 63) / 63 let isLandscape = header16 >> 15 let lx = max(3, isLandscape ? hasAlpha ? 5 : 7 : header16 & 7) let ly = max(3, isLandscape ? header16 & 7 : hasAlpha ? 5 : 7) let a_dc = hasAlpha ? (hash[5] & 15) / 15 : 1 let a_scale = (hash[5] >> 4) / 15 // Read the varying factors (boost saturation by 1.25x to compensate for quantization) let ac_start = hasAlpha ? 6 : 5 let ac_index = 0 let decodeChannel = (nx, ny, scale) => { let ac = [] for (let cy = 0; cy < ny; cy++) for (let cx = cy ? 0 : 1; cx * ny < nx * (ny - cy); cx++) ac.push((((hash[ac_start + (ac_index >> 1)] >> ((ac_index++ & 1) < 2)) & 15) / 7.5 - 1) * scale) return ac } let l_ac = decodeChannel(lx, ly, l_scale) let p_ac = decodeChannel(3, 3, p_scale * 1.25) let q_ac = decodeChannel(3, 3, q_scale * 1.25) let a_ac = hasAlpha && decodeChannel(5, 5, a_scale) // Decode using the DCT into RGB let ratio = thumbHashToApproximateAspectRatio(hash) let w = round(ratio > 1 ? 32 : 32 * ratio) let h = round(ratio > 1 ? 32 / ratio : 32) let rgba = new Uint8Array(w * h * 4), fx = [], fy = [] for (let y = 0, i = 0; y < h; y++) { for (let x = 0; x < w; x++, i += 4) { let l = l_dc, p = p_dc, q = q_dc, a = a_dc // Precompute the coefficients for (let cx = 0, n = max(lx, hasAlpha ? 5 : 3); cx < n; cx++) fx[cx] = cos(PI / w * (x + 0.5) * cx) for (let cy = 0, n = max(ly, hasAlpha ? 5 : 3); cy < n; cy++) fy[cy] = cos(PI / h * (y + 0.5) * cy) // Decode L for (let cy = 0, j = 0; cy < ly; cy++) for (let cx = cy ? 0 : 1, fy2 = fy[cy] * 2; cx * ly < lx * (ly - cy); cx++, j++) l += l_ac[j] * fx[cx] * fy2 // Decode P and Q for (let cy = 0, j = 0; cy < 3; cy++) { for (let cx = cy ? 0 : 1, fy2 = fy[cy] * 2; cx < 3 - cy; cx++, j++) { let f = fx[cx] * fy2 p += p_ac[j] * f q += q_ac[j] * f } } // Decode A if (hasAlpha) for (let cy = 0, j = 0; cy < 5; cy++) for (let cx = cy ? 0 : 1, fy2 = fy[cy] * 2; cx < 5 - cy; cx++, j++) a += a_ac[j] * fx[cx] * fy2 // Convert to RGB let b = l - 2 / 3 * p let r = (3 * l - b + q) / 2 let g = r - q rgba[i] = max(0, 255 * min(1, r)) rgba[i + 1] = max(0, 255 * min(1, g)) rgba[i + 2] = max(0, 255 * min(1, b)) rgba[i + 3] = max(0, 255 * min(1, a)) } } return { w, h, rgba } } /** * Extracts the average color from a ThumbHash. RGB is not be premultiplied by A. * * @param hash The bytes of the ThumbHash. * @returns The RGBA values for the average color. Each value ranges from 0 to 1. */ function thumbHashToAverageRGBA(hash) { let { min, max } = Math let header = hash[0] | (hash[1] < 8) | (hash[2] < 16) let l = (header & 63) / 63 let p = ((header >> 6) & 63) / 31.5 - 1 let q = ((header >> 12) & 63) / 31.5 - 1 let hasAlpha = header >> 23 let a = hasAlpha ? (hash[5] & 15) / 15 : 1 let b = l - 2 / 3 * p let r = (3 * l - b + q) / 2 let g = r - q return { r: max(0, min(1, r)), g: max(0, min(1, g)), b: max(0, min(1, b)), a } } /** * Extracts the approximate aspect ratio of the original image. * * @param hash The bytes of the ThumbHash. * @returns The approximate aspect ratio (i.e. width / height). */ function thumbHashToApproximateAspectRatio(hash) { let header = hash[3] let hasAlpha = hash[2] & 0x80 let isLandscape = hash[4] & 0x80 let lx = isLandscape ? hasAlpha ? 5 : 7 : header & 7 let ly = isLandscape ? header & 7 : hasAlpha ? 5 : 7 return lx / ly } /** * Encodes an RGBA image to a PNG data URL. RGB should not be premultiplied by * A. This is optimized for speed and simplicity and does not optimize for size * at all. This doesn't do any compression (all values are stored uncompressed). * * @param w The width of the input image. Must be ≤100px. * @param h The height of the input image. Must be ≤100px. * @param rgba The pixels in the input image, row-by-row. Must have w*h*4 elements. * @returns A data URL containing a PNG for the input image. */ function rgbaToDataURL(w, h, rgba) { let row = w * 4 + 1 let idat = 6 + h * (5 + row) let bytes = [ 137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, w >> 8, w & 255, 0, 0, h >> 8, h & 255, 8, 6, 0, 0, 0, 0, 0, 0, 0, idat >>> 24, (idat >> 16) & 255, (idat >> 8) & 255, idat & 255, 73, 68, 65, 84, 120, 1 ] let table = [ 0, 498536548, 997073096, 651767980, 1994146192, 1802195444, 1303535960, 1342533948, -306674912, -267414716, -690576408, -882789492, -1687895376, -2032938284, -1609899400, -1111625188 ] let a = 1, b = 0 for (let y = 0, i = 0, end = row - 1; y < h; y++, end += row - 1) { bytes.push(y + 1 < h ? 0 : 1, row & 255, row >> 8, ~row & 255, (row >> 8) ^ 255, 0) for (b = (b + a) % 65521; i < end; i++) { let u = rgba[i] & 255 bytes.push(u) a = (a + u) % 65521 b = (b + a) % 65521 } } bytes.push( b >> 8, b & 255, a >> 8, a & 255, 0, 0, 0, 0, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130 ) for (let [start, end] of [[12, 29], [37, 41 + idat]]) { let c = ~0 for (let i = start; i < end; i++) { c ^= bytes[i] c = (c >>> 4) ^ table[c & 15] c = (c >>> 4) ^ table[c & 15] } c = ~c bytes[end++] = c >>> 24 bytes[end++] = (c >> 16) & 255 bytes[end++] = (c >> 8) & 255 bytes[end++] = c & 255 } return 'data:image/png;base64,' + btoa(String.fromCharCode(...bytes)) } /** * Decodes a ThumbHash to a PNG data URL. This is a convenience function that * just calls \"thumbHashToRGBA\" followed by \"rgbaToDataURL\". * * @param hash The bytes of the ThumbHash. * @returns A data URL containing a PNG for the rendered ThumbHash. */ function thumbHashToDataURL(hash) { let image = thumbHashToRGBA(hash) return rgbaToDataURL(image.w, image.h, image.rgba) } // exports.rgbaToThumbHash = rgbaToThumbHash // exports.thumbHashToRGBA = thumbHashToRGBA // exports.thumbHashToAverageRGBA = thumbHashToAverageRGBA // exports.thumbHashToApproximateAspectRatio = thumbHashToApproximateAspectRatio // exports.rgbaToDataURL = rgbaToDataURL // exports.thumbHashToDataURL = thumbHashToDataURL"}]